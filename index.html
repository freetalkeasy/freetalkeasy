<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤šåœ‹èªè¨€å–®å­—å¡ (FreeTalkEasy)</title>
    <style>
        body { font-family: 'Microsoft JhengHei', sans-serif; background-color: #f0f2f5; margin: 0; padding: 20px; }
        
        /* æœå°‹æ¡†å€ */
        .search-container { text-align: center; margin-bottom: 20px; }
        #searchInput {
            width: 100%; max-width: 400px; padding: 12px; 
            border-radius: 25px; border: 1px solid #ccc; 
            font-size: 16px; outline: none;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        /* æŒ‰éˆ•å®¹å™¨é€šç”¨æ¨£å¼ */
        .scroll-container {
            display: flex; gap: 10px; overflow-x: auto; 
            padding-bottom: 10px; margin-bottom: 15px;
            justify-content: center; /* ç½®ä¸­ */
        }

        /* èªè¨€åˆ‡æ›æŒ‰éˆ• (ç¬¬ä¸€å±¤) */
        .lang-btn {
            padding: 10px 20px; background: #fff; border: 2px solid #007bff; 
            color: #007bff; border-radius: 8px; cursor: pointer; 
            font-weight: bold; white-space: nowrap; transition: 0.2s;
        }
        .lang-btn.active { background: #007bff; color: white; }

        /* åˆ†é¡æŒ‰éˆ• (ç¬¬äºŒå±¤) */
        .cat-btn {
            padding: 6px 14px; background: #fff; border: 1px solid #ccc; 
            border-radius: 20px; cursor: pointer; white-space: nowrap; 
            font-size: 0.9rem; transition: 0.2s;
        }
        .cat-btn.active, .cat-btn:hover {
            background: #d32f2f; color: white; border-color: #d32f2f;
        }

        /* å¡ç‰‡å€ */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
        }
        .card {
            background: white; padding: 20px 15px;
            border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center; cursor: pointer; transition: transform 0.2s;
            position: relative; border-bottom: 4px solid transparent;
        }
        .card:active { transform: scale(0.95); }
        .card h3 { margin: 5px 0; color: #333; font-size: 1.3rem; word-break: break-word; }
        .card p { margin: 0; color: #888; font-size: 0.95rem; }
        .icon { font-size: 24px; margin-bottom: 8px; display: block; opacity: 0.7; }
        
        /* æ’­æ”¾ä¸­çš„ç‰¹æ•ˆ */
        .playing { 
            border-bottom: 4px solid #d32f2f; 
            background-color: #fff5f5; 
            transform: translateY(-2px);
        }
    </style>
</head>
<body>

    <div class="search-container">
        <input type="text" id="searchInput" placeholder="ğŸ” æœå°‹å–®å­— (ä¾‹å¦‚: apple æˆ– è˜‹æœ)...">
    </div>

    <div class="scroll-container" id="langContainer">
        </div>

    <div class="scroll-container" id="categoryContainer">
        <button class="cat-btn active" onclick="filterCategory('all', this)">å…¨éƒ¨é¡¯ç¤º</button>
    </div>

    <div class="grid" id="cardContainer"></div>

    <script src="data.js"></script>

    <script>
        // è¨­å®šèªè¨€å°ç…§è¡¨ (é¡¯ç¤ºåç¨± : ä»£ç¢¼)
        const LANGUAGES = [
            { name: 'ğŸ‡ºğŸ‡¸ è‹±èª', code: 'en' },
            { name: 'ğŸ‡¯ğŸ‡µ æ—¥èª', code: 'ja' },
            { name: 'ğŸ‡°ğŸ‡· éŸ“èª', code: 'ko' },
            { name: 'ğŸ‡»ğŸ‡³ è¶Šèª', code: 'vi' },
            { name: 'ğŸ‡­ğŸ‡° å»£æ±', code: 'zh-CN' } // å°æ‡‰ Python è£¡çš„è¨­å®š
        ];

        // é è¨­ç‹€æ…‹
        let currentLang = 'en'; 
        let currentCategory = 'all';
        let currentAudio = null;

        // ç¢ºèªè³‡æ–™æ˜¯å¦è¼‰å…¥
        if (typeof vocabData === 'undefined') {
            document.body.innerHTML = "<h2 style='text-align:center; color:red;'>âš ï¸ éŒ¯èª¤ï¼šæ‰¾ä¸åˆ° data.js<br>è«‹å…ˆåŸ·è¡Œ Python ç¨‹å¼ï¼</h2>";
        } else {
            initApp();
        }

        function initApp() {
            renderLangButtons();
            renderCategoryButtons();
            renderCards(); // åˆå§‹æ¸²æŸ“
        }

        // --- 1. ç”¢ç”Ÿèªè¨€æŒ‰éˆ• ---
        function renderLangButtons() {
            const container = document.getElementById('langContainer');
            LANGUAGES.forEach(lang => {
                const btn = document.createElement('button');
                btn.className = `lang-btn ${lang.code === currentLang ? 'active' : ''}`;
                btn.innerText = lang.name;
                btn.onclick = () => switchLanguage(lang.code, btn);
                container.appendChild(btn);
            });
        }

        function switchLanguage(code, btn) {
            currentLang = code;
            // æ›´æ–°æŒ‰éˆ•æ¨£å¼
            document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            // é‡æ–°æ¸²æŸ“å¡ç‰‡
            renderCards();
        }

        // --- 2. ç”¢ç”Ÿåˆ†é¡æŒ‰éˆ• ---
        function renderCategoryButtons() {
            const container = document.getElementById('categoryContainer');
            // å¾è³‡æ–™ä¸­æå–æ‰€æœ‰ä¸é‡è¤‡çš„ã€Œå¤§åˆ†é¡ã€
            const categories = [...new Set(vocabData.map(item => item.category))].filter(Boolean);
            
            categories.forEach(cat => {
                const btn = document.createElement('button');
                btn.className = 'cat-btn';
                btn.innerText = cat;
                btn.onclick = () => filterCategory(cat, btn);
                container.appendChild(btn);
            });
        }

        function filterCategory(category, btn) {
            currentCategory = category;
            // æ›´æ–°æ¨£å¼
            document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
            if(btn) btn.classList.add('active');
            
            renderCards();
        }

        // --- 3. æ ¸å¿ƒï¼šæ¸²æŸ“å¡ç‰‡ ---
        function renderCards() {
            const container = document.getElementById('cardContainer');
            const searchText = document.getElementById('searchInput').value.toLowerCase();
            container.innerHTML = '';

            // ç¯©é¸è³‡æ–™
            const filteredData = vocabData.filter(item => {
                // 1. æª¢æŸ¥è©²èªè¨€æ˜¯å¦æœ‰è³‡æ–™ (æœ‰äº›å­—å¯èƒ½ç¼ºç¿»è­¯)
                if (!item[currentLang]) return false;

                // 2. åˆ†é¡ç¯©é¸
                if (currentCategory !== 'all' && item.category !== currentCategory) return false;

                // 3. é—œéµå­—æœå°‹ (æœä¸­æ–‡ æˆ– ç•¶å‰èªè¨€å–®å­—)
                const word = item[currentLang].word.toLowerCase();
                const cn = item.cn.toLowerCase();
                if (searchText && !word.includes(searchText) && !cn.includes(searchText)) return false;

                return true;
            });

            if (filteredData.length === 0) {
                container.innerHTML = '<p style="text-align:center; width:100%; color:#888;">æ²’æœ‰æ‰¾åˆ°è³‡æ–™ ğŸ˜…</p>';
                return;
            }

            filteredData.forEach(item => {
                const langData = item[currentLang]; // å–å¾—ç•¶å‰èªè¨€çš„è³‡æ–™ç‰©ä»¶
                
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <span class="icon">ğŸ”Š</span>
                    <h3>${langData.word}</h3> <p>${item.cn}</p>         `;

                // è¨­å®šé»æ“Šæ’­æ”¾
                // çµ„åˆè·¯å¾‘: folder (ä¾‹å¦‚ CN_ENG/audio) + / + filename
                const audioPath = `${langData.folder}/${langData.audio}`;
                card.onclick = () => playSound(audioPath, card);

                container.appendChild(card);
            });
        }

        // --- 4. æ’­æ”¾åŠŸèƒ½ ---
        function playSound(path, cardElement) {
            if (currentAudio) {
                currentAudio.pause();
                currentAudio.currentTime = 0;
            }

            // UI ç‰¹æ•ˆ
            document.querySelectorAll('.card').forEach(c => c.classList.remove('playing'));
            cardElement.classList.add('playing');

            currentAudio = new Audio(path);
            
            // éŒ¯èª¤è™•ç†
            currentAudio.onerror = () => {
                alert(`âŒ æ‰¾ä¸åˆ°éŸ³æª”ï¼š\n${path}\nè«‹ç¢ºèª Python ç¨‹å¼æ˜¯å¦åŸ·è¡ŒæˆåŠŸã€‚`);
                cardElement.classList.remove('playing');
            };

            currentAudio.play().catch(e => console.log("æ’­æ”¾è¢«ç€è¦½å™¨é˜»æ“‹:", e));

            currentAudio.onended = () => cardElement.classList.remove('playing');
        }

        // --- 5. æœå°‹ç›£è½ ---
        document.getElementById('searchInput').addEventListener('input', () => {
            renderCards(); // æ‰“å­—æ™‚å³æ™‚æ›´æ–°
        });

    </script>
</body>
</html>