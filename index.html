<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FreeTalkEasy Multilingual Flashcards</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #4a90e2;
            --bg-color: #f5f7fa;
            --card-shadow: 0 2px 4px rgba(0,0,0,0.08); /* è¼•é‡åŒ–é™°å½± */
            
            /* 5-Level Color System (Backgrounds) */
            --lvl-0-bg: #ffffff; /* White - New */
            --lvl-1-bg: #e3f2fd; /* Blue - 1+ clicks */
            --lvl-2-bg: #e8f5e9; /* Green - 3+ clicks */
            --lvl-3-bg: #fff9c4; /* Yellow - 10+ clicks */
            --lvl-4-bg: #ffe0b2; /* Orange - 20+ clicks */
            --lvl-5-bg: #ffebee; /* Red - 30+ clicks (Master) */
        }

        body {
            font-family: 'Noto Sans TC', 'Roboto', sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        h1 { margin-bottom: 20px; color: #333; text-align: center; font-size: 1.5rem; }

        /* Controls */
        .controls {
            margin-bottom: 20px;
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            justify-content: center;
        }

        select {
            padding: 8px 12px;
            font-size: 14px;
            border-radius: 6px;
            border: 1px solid #ddd;
            background-color: white;
            cursor: pointer;
        }

        /* Legend Bar */
        .legend {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            font-size: 11px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .legend-item {
            padding: 3px 8px;
            border-radius: 4px;
            border: 1px solid #ccc;
            background-color: white;
        }

        /* Card Container - Grid èª¿æ•´ */
        #card-container {
            display: grid;
            /* æœ€å°å¯¬åº¦æ”¹ç‚º 180pxï¼Œè®“å¡ç‰‡æ›´ç·Šæ¹Šé©åˆå–®å­— */
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); 
            gap: 15px;
            width: 100%;
            max-width: 1000px;
            flex: 1; /* Push footer to bottom */
        }

        /* Flashcard Styles - ç·Šæ¹Šç‰ˆ */
        .card {
            background-color: var(--lvl-0-bg);
            border-radius: 8px;
            padding: 12px;
            box-shadow: var(--card-shadow);
            cursor: pointer;
            transition: transform 0.2s, background-color 0.3s;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            border: 1px solid #e0e0e0;
            position: relative;
            min-height: 140px; /* é™åˆ¶é«˜åº¦ï¼Œé¿å…å¤ªé•· */
        }

        .card:hover { transform: translateY(-3px); }
        .card:active { transform: scale(0.98); }

        /* Level Colors Classes */
        .level-0 { background-color: var(--lvl-0-bg); }
        .level-1 { background-color: var(--lvl-1-bg); border-color: #90caf9; }
        .level-2 { background-color: var(--lvl-2-bg); border-color: #a5d6a7; }
        .level-3 { background-color: var(--lvl-3-bg); border-color: #fff59d; }
        .level-4 { background-color: var(--lvl-4-bg); border-color: #ffcc80; }
        .level-5 { background-color: var(--lvl-5-bg); border-color: #ef9a9a; }

        .card-header {
            font-size: 10px;
            color: #888;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
        }

        .main-word {
            font-size: 20px; /* å­—é«”é©ä¸­ */
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 4px;
            line-height: 1.2;
        }

        .phonetic {
            font-size: 13px;
            color: #7f8c8d;
            margin-bottom: 10px;
            font-style: italic;
        }

        .footer-translation {
            margin-top: auto;
            padding-top: 8px;
            border-top: 1px dashed rgba(0,0,0,0.1); /* è™›ç·šåˆ†éš” */
            font-size: 12px;
            color: #555;
            line-height: 1.3;
        }

        .footer-flag { margin-right: 3px; }

        /* Counter badge */
        .click-counter {
            background: rgba(0,0,0,0.05);
            padding: 1px 5px;
            border-radius: 8px;
            font-size: 9px;
        }

        /* App Footer (SEO Links) - æ·¡åŒ–è™•ç† */
        .app-footer {
            margin-top: 50px;
            padding: 20px;
            width: 100%;
            text-align: center;
            border-top: 1px solid #eee;
            background-color: #fff;
            color: #999;
        }
        
        .app-footer a {
            color: #aaa;
            text-decoration: none;
            margin: 0 5px;
            font-size: 12px;
            transition: color 0.2s;
        }
        
        .app-footer a:hover {
            color: #666;
            text-decoration: underline;
        }

        .app-footer .main-link {
            font-weight: bold;
            font-size: 13px;
            display: block;
            margin-bottom: 10px;
            color: #7faad9; /* æ·ºè—è‰² */
        }

    </style>
</head>
<body>

    <h1>ğŸŒ FreeTalkEasy Flashcards</h1>

    <div class="controls">
        <select id="lang-select">
            <option value="CN_ENG">ğŸ‡ºğŸ‡¸ è‹±èª (English)</option>
            <option value="CN_JP">ğŸ‡¯ğŸ‡µ æ—¥èª (Japanese)</option>
            <option value="CN_KR">ğŸ‡°ğŸ‡· éŸ“èª (Korean)</option>
            <option value="CN_VN">ğŸ‡»ğŸ‡³ è¶Šèª (Vietnamese)</option>
            <option value="CN_TH">ğŸ‡¹ğŸ‡­ æ³°èª (Thai)</option>
            <option value="CN_ID">ğŸ‡®ğŸ‡© å°å°¼èª (Indonesian)</option>
            <option value="CN_FR">ğŸ‡«ğŸ‡· æ³•èª (French)</option>
            <option value="CN_DE">ğŸ‡©ğŸ‡ª å¾·èª (German)</option>
            <option value="CN_ES">ğŸ‡ªğŸ‡¸ è¥¿èª (Spanish)</option>
            <option value="CN_RU">ğŸ‡·ğŸ‡º ä¿„èª (Russian)</option>
            <option value="CN_CON">ğŸ‡­ğŸ‡° å»£æ±è©± (Cantonese)</option>
            <option value="CN_ZH">ğŸ‡¹ğŸ‡¼ ä¸­æ–‡ (Chinese Mode)</option>
        </select>
        
        <select id="category-filter">
            <option value="all">æ‰€æœ‰åˆ†é¡ (All Categories)</option>
        </select>
    </div>

    <div class="legend">
        <div class="legend-item level-0">New (0)</div>
        <div class="legend-item level-1">Lv1 (1+)</div>
        <div class="legend-item level-2">Lv2 (3+)</div>
        <div class="legend-item level-3">Lv3 (10+)</div>
        <div class="legend-item level-4">Lv4 (20+)</div>
        <div class="legend-item level-5">Lv5 Master (30+)</div>
    </div>

    <div id="card-container">Loading...</div>

    <footer class="app-footer">
        <a href="seo_pages/sitemap.html" class="main-link">ğŸ“š æŸ¥çœ‹æ‰€æœ‰å–®å­—åˆ—è¡¨ (Vocabulary Lists)</a>
        
        <div class="sub-links">
            <a href="seo_pages/about.html">é—œæ–¼æˆ‘å€‘</a> | 
            <a href="seo_pages/privacy.html">éš±ç§æ¬Šæ”¿ç­– (Privacy Policy)</a> | 
            <a href="seo_pages/contact.html">è¯çµ¡æˆ‘å€‘</a>
        </div>
        
        <div style="margin-top: 15px; font-size: 11px; color: #ccc;">
            &copy; 2024 FreeTalkEasy Project. All rights reserved.
        </div>
    </footer>

    <script src="data.js"></script>

    <script>
        // State
        let currentLang = 'CN_ENG'; // Default
        const STORAGE_KEY_PREFIX = 'fte_clicks_';

        // DOM Elements
        const container = document.getElementById('card-container');
        const langSelect = document.getElementById('lang-select');
        const catFilter = document.getElementById('category-filter');

        // Initialization
        window.onload = () => {
            if (typeof vocabData === 'undefined') {
                container.innerHTML = "<p style='text-align:center; color:red; grid-column: 1/-1;'>âŒ Error: <code>data.js</code> not found.<br>Please run <code>python build_website.py</code> first.</p>";
                return;
            }
            populateCategories();
            renderCards();
        };

        // Event Listeners
        langSelect.addEventListener('change', (e) => {
            currentLang = e.target.value;
            renderCards();
        });

        catFilter.addEventListener('change', () => {
            renderCards();
        });

        // Helper: Get click count from local storage
        function getClicks(id) {
            return parseInt(localStorage.getItem(STORAGE_KEY_PREFIX + id) || '0');
        }

        // Helper: Increment click count
        function addClick(id) {
            const current = getClicks(id);
            const newCount = current + 1;
            localStorage.setItem(STORAGE_KEY_PREFIX + id, newCount);
            return newCount;
        }

        // Helper: Determine Level Class
        function getLevelClass(clicks) {
            if (clicks >= 30) return 'level-5';
            if (clicks >= 20) return 'level-4';
            if (clicks >= 10) return 'level-3';
            if (clicks >= 3) return 'level-2';
            if (clicks >= 1) return 'level-1';
            return 'level-0';
        }

        // Populate Categories
        function populateCategories() {
            const categories = [...new Set(vocabData.map(item => item.category))];
            categories.forEach(cat => {
                if(cat) {
                    const opt = document.createElement('option');
                    opt.value = cat;
                    opt.innerText = cat;
                    catFilter.appendChild(opt);
                }
            });
        }

        // Main Render Function
        function renderCards() {
            container.innerHTML = '';
            const selectedCat = catFilter.value;
            const isChineseMode = (currentLang === 'CN_ZH');

            vocabData.forEach(item => {
                // 1. Category Filter
                if (selectedCat !== 'all' && item.category !== selectedCat) return;

                // 2. Data Check for target language
                const targetData = item[currentLang];
                if (!targetData) return;

                // 3. Smart Filtering (Chinese Mode Rules)
                if (isChineseMode) {
                    const catName = (item.category || "").toLowerCase();
                    const subCatName = (item.subcategory || "").toLowerCase();
                    if (catName.includes('å­—æ¯') || catName.includes('äº”åéŸ³') || 
                        subCatName.includes('alphabet') || subCatName.includes('letter')) {
                        return;
                    }
                }

                // Prepare Content
                const clicks = getClicks(item.id);
                const levelClass = getLevelClass(clicks);
                
                let mainText = targetData.word;
                let subText = targetData.phonetic || "";
                let footerHtml = "";

                if (isChineseMode) {
                    // Chinese Mode: Show 5 specific languages
                    const langsToShow = [
                        {code: 'CN_ENG', flag: 'ğŸ‡ºğŸ‡¸'},
                        {code: 'CN_VN', flag: 'ğŸ‡»ğŸ‡³'},
                        {code: 'CN_JP', flag: 'ğŸ‡¯ğŸ‡µ'},
                        {code: 'CN_TH', flag: 'ğŸ‡¹ğŸ‡­'},
                        {code: 'CN_ID', flag: 'ğŸ‡®ğŸ‡©'}
                    ];
                    
                    let footerParts = [];
                    langsToShow.forEach(l => {
                        if (item[l.code] && item[l.code].word) {
                            let w = item[l.code].word.replace(/[\(ï¼ˆ].*?[\)ï¼‰]/, '').trim(); 
                            footerParts.push(`<span class="footer-flag">${l.flag}</span> ${w}`);
                        }
                    });
                    footerHtml = footerParts.join('<br>');

                } else {
                    // Standard Mode
                    const cnWord = item.cn;
                    const engWord = item['CN_ENG'] ? item['CN_ENG'].word : '';
                    
                    footerHtml = `ğŸ‡¹ğŸ‡¼ ${cnWord}`;
                    
                    if (currentLang !== 'CN_ENG' && engWord) {
                        let cleanEng = engWord.replace(/[\(ï¼ˆ].*?[\)ï¼‰]/, '').trim();
                        footerHtml += `<br>ğŸ‡ºğŸ‡¸ ${cleanEng}`;
                    }
                }

                // Create Card Element
                const card = document.createElement('div');
                card.className = `card ${levelClass}`;
                card.id = `card-${item.id}`;

                card.innerHTML = `
                    <div class="card-header">
                        <span>${item.category}</span>
                        <span class="click-counter">${clicks}</span>
                    </div>
                    <div>
                        <div class="main-word">${mainText}</div>
                        <div class="phonetic">${subText}</div>
                    </div>
                    <div class="footer-translation">
                        ${footerHtml}
                    </div>
                `;

                // Click to play audio
                card.addEventListener('click', () => {
                    const audioPath = `${targetData.folder}/${targetData.audio}`;
                    const audio = new Audio(audioPath);
                    audio.play().catch(e => console.log("Audio error:", e));

                    const newCount = addClick(item.id);
                    card.className = `card ${getLevelClass(newCount)}`;
                    card.querySelector('.click-counter').innerText = newCount;
                });

                container.appendChild(card);
            });
        }
    </script>
</body>
</html>